<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KU-DETA ã‚·ãƒ•ãƒˆæå‡ºï¼ˆä¸‹æ›¸ãâ†’ä¸€æ‹¬é€ä¿¡ ç‰ˆï¼‰</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  :root{
    --fg:#111827; --muted:#6b7280; --bd:#e5e7eb; --bg:#fafafa; --card:#ffffff;
    --btn:#111827; --ok:#16a34a; --warn:#f59e0b; --err:#b91c1c;
    --lunch:#fff3bf; --dinner:#ffe0cc; --draft:#fef9c3; --sent:#dcfce7;
  }
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;
       max-width:1100px;margin:24px auto;padding:0 14px;background:var(--bg);color:var(--fg)}
  h1{font-size:1.6rem;margin:0 0 .75rem}
  .note{color:var(--muted);font-size:.92rem}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  input,select,button,textarea{border:1px solid var(--bd);border-radius:10px;padding:9px 10px;font-size:15px;background:#fff}
  button{background:var(--btn);color:#fff;font-weight:700;border:none;cursor:pointer}
  button.ghost{background:#fff;color:var(--fg)}
  button.warn{background:var(--warn);color:#111}
  button:disabled{opacity:.5;cursor:not-allowed}
  .card{background:var(--card);border:1px solid var(--bd);border-radius:14px;padding:14px;margin:12px 0}
  .grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
  .dow{font-weight:700;text-align:center;color:#374151}
  .cell{border:1px solid var(--bd);border-radius:10px;min-height:100px;background:#fff;padding:6px;position:relative;cursor:pointer}
  .cell:hover{outline:2px solid #e5e7eb}
  .day{position:absolute;top:6px;left:8px;font-weight:700;font-size:.92rem;color:#4b5563}
  .mark{position:absolute;bottom:6px;left:6px;right:6px;font-size:.78rem;display:flex;flex-direction:column;gap:4px}
  .tag{display:inline-block;border-radius:6px;padding:2px 6px;font-size:.78rem;border:1px solid var(--bd)}
  .tag.l{background:var(--lunch)} .tag.d{background:var(--dinner)}
  .tag.draft{background:var(--draft)}
  .tag.sent{background:var(--sent);border-color:#86efac}
  .today{outline:2px solid var(--warn)}
  .selected{outline:2px solid var(--btn)}
  .pill{background:#f3f4f6;border:1px solid var(--bd);border-radius:999px;padding:6px 10px}
  .right{margin-left:auto}
  .small{font-size:.88rem}
  .msg{margin-top:6px;font-weight:700}
  .ok{color:var(--ok)} .err{color:var(--err)}
  .box{border:1px dashed var(--bd);border-radius:12px;padding:12px}
  .box.l{background:var(--lunch)} .box.d{background:var(--dinner)}
  .muted{opacity:.5}
</style>
</head>
<body>
  <h1>KU-DETA ã‚·ãƒ•ãƒˆæå‡º</h1>

  <!-- ä¸Šéƒ¨ï¼šåå‰ãƒ­ãƒƒã‚¯ -->
  <div class="card">
    <div class="row">
      <strong>ã‚ãªãŸã®åå‰</strong>
      <select id="nameSel" style="min-width:220px"></select>
      <input id="nameNew" placeholder="ï¼ˆæ–°è¦ï¼‰ä¾‹ï¼šä¹…ç´ çœŸå¸Œ" style="min-width:220px">
      <button id="addNameBtn">ï¼‹ ç™»éŒ²</button>
      <button id="lockBtn" class="ghost">âœ”ï¸ ãƒ­ãƒƒã‚¯</button>
      <span id="lockState" class="note"></span>
      <span class="right note small">åŠæœˆã”ã¨ã«æå‡ºã€‚ç· åˆ‡ã¯ <strong>15æ—¥ãƒ»æœˆæœ«</strong>ï¼ˆçŒ¶äºˆ3æ—¥ã¯ç®¡ç†è€…ã®ã¿ç·¨é›†å¯ï¼‰ã€‚æ™‚é–“æŒ‡å®šãªã—ã¯ã€Œâ—¯ã€ã€‚</span>
    </div>
  </div>

  <!-- å…¥åŠ›ãƒ‘ãƒãƒ«ï¼ˆã“ã®æ—¥ã«ä¸‹æ›¸ãä¿å­˜ â†’ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ç©ã‚€ï¼‰-->
  <div class="card">
    <div class="row" style="justify-content:space-between">
      <div class="row">
        <button id="prevBtn" class="ghost">Â« å‰æœˆ</button>
        <div class="pill"><span id="ymLabel">YYYYå¹´Mæœˆ</span></div>
        <button id="thisBtn" class="ghost">ä»Šæœˆ</button>
        <button id="nextBtn" class="ghost">æ¬¡æœˆ Â»</button>
      </div>
      <div class="row">
        <label class="note">é¸æŠä¸­</label>
        <input id="dateInp" type="date">
        <button id="saveDraftBtn" class="warn">ã“ã®æ—¥ã‚’ä¸‹æ›¸ãã«è¿½åŠ /æ›´æ–°</button>
        <button id="removeDraftBtn" class="ghost">ã“ã®æ—¥ã‚’ä¸‹æ›¸ãã‹ã‚‰å‰Šé™¤</button>
        <button id="bulkSendBtn">ğŸ§¾ ä¸‹æ›¸ãã‚’ã¾ã¨ã‚ã¦é€ä¿¡</button>
      </div>
    </div>

    <div class="row">
      <!-- ãƒ©ãƒ³ãƒ -->
      <div class="box l" style="flex:1 1 360px">
        <div class="row small"><strong>ãƒ©ãƒ³ãƒï¼ˆ10:00â€“16:00ï¼‰</strong><span class="note">â€»ãƒã‚§ãƒƒã‚¯ä¸è¦ã€æ™‚é–“å…¥åŠ›ã¾ãŸã¯ã€Œâ—¯ã€ã§åˆ¤å®š</span></div>
        <div class="row">
          <label>é–‹å§‹<select id="lStart"></select></label>
          <label>çµ‚äº†<select id="lEnd"></select></label>
          <label class="small" style="display:flex;align-items:center;gap:6px">
            <input type="checkbox" id="lFree"> æ™‚é–“æŒ‡å®šãªã—ï¼ˆâ—¯ï¼‰
          </label>
        </div>
      </div>
      <!-- ãƒ‡ã‚£ãƒŠãƒ¼ -->
      <div class="box d" style="flex:1 1 360px">
        <div class="row small"><strong>ãƒ‡ã‚£ãƒŠãƒ¼ï¼ˆ17:00â€“24:00ï¼‰</strong><span class="note">â€»ãƒã‚§ãƒƒã‚¯ä¸è¦ã€æ™‚é–“å…¥åŠ›ã¾ãŸã¯ã€Œâ—¯ã€ã§åˆ¤å®š</span></div>
        <div class="row">
          <label>é–‹å§‹<select id="dStart"></select></label>
          <label>çµ‚äº†<select id="dEnd"></select></label>
          <label class="small" style="display:flex;align-items:center;gap:6px">
            <input type="checkbox" id="dFree"> æ™‚é–“æŒ‡å®šãªã—ï¼ˆâ—¯ï¼‰
          </label>
        </div>
      </div>
    </div>

    <div class="row" style="margin-top:8px">
      <label style="flex:1">å‚™è€ƒï¼ˆä»»æ„ï¼‰<textarea id="memo" rows="2" style="width:100%"></textarea></label>
    </div>
    <div id="msg" class="msg"></div>
  </div>

  <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼šå·¦=ä¸‹æ›¸ã, å³=é€ä¿¡æ¸ˆã¿ -->
  <div class="card">
    <div class="row small note" style="margin-bottom:8px">
      <span class="pill"> legendï¼š<span class="tag l">ãƒ©ãƒ³ãƒ</span> <span class="tag d">ãƒ‡ã‚£ãƒŠãƒ¼</span>ï¼
        <span class="tag draft">ä¸‹æ›¸ãã‚ã‚Š</span> <span class="tag sent">é€ä¿¡æ¸ˆã¿</span> ï¼ ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼é¸æŠæ—¥</span>
      <button id="toListBtn" class="right ghost">æå‡ºä¸€è¦§ã‚’è¦‹ã‚‹</button>
    </div>
    <div id="cal" class="grid"></div>
  </div>

<script>
/* ===== Supabase æ¥ç¶š ===== */
const SUPABASE_URL = "https://wnttziqspjkrinymnodz.supabase.co";
const SUPABASE_ANON_KEY = "YOUR-ANON-KEY-PASTE-HERE";  // â† Supabase ã® anon key ã‚’è²¼ã£ã¦ãã ã•ã„
const supa = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* ===== è¦ç´  ===== */
const $ = id => document.getElementById(id);
const nameSel=$('nameSel'), nameNew=$('nameNew'), addNameBtn=$('addNameBtn'),
      lockBtn=$('lockBtn'), lockState=$('lockState'),
      lStart=$('lStart'), lEnd=$('lEnd'), lFree=$('lFree'),
      dStart=$('dStart'), dEnd=$('dEnd'), dFree=$('dFree'),
      memo=$('memo'), dateInp=$('dateInp'), msg=$('msg');

/* ===== åå‰ãƒ­ãƒƒã‚¯ ===== */
function loadLock(){
  const nm = localStorage.getItem('shift_name') || '';
  if(nm){ ensureOption(nameSel,nm); nameSel.value=nm; setLock(true); }
  else { setLock(false); }
}
function setLock(on){
  nameSel.disabled=on; nameNew.disabled=on; addNameBtn.disabled=on;
  lockBtn.textContent = on ? 'ğŸ”“ å¤‰æ›´' : 'âœ”ï¸ ãƒ­ãƒƒã‚¯';
  lockState.textContent = on ? `ãƒ­ãƒƒã‚¯ä¸­ï¼š${nameSel.value}` : 'æœªãƒ­ãƒƒã‚¯';
}
lockBtn.onclick = ()=>{
  const on=nameSel.disabled;
  if(on){ localStorage.removeItem('shift_name'); setLock(false); }
  else{
    const v=(nameSel.value||'').trim();
    if(!v){ alert('åå‰ã‚’é¸ã¶/ç™»éŒ²ã—ã¦ãã ã•ã„'); return; }
    localStorage.setItem('shift_name',v); setLock(true);
  }
};
addNameBtn.onclick = ()=>{
  const nm=nameNew.value.trim();
  if(!nm){ alert('åå‰ã‚’å…¥åŠ›'); return; }
  ensureOption(nameSel,nm,true); nameSel.value=nm; nameNew.value='';
  localStorage.setItem('shift_name',nm); setLock(true);
};
function ensureOption(sel, val, appendOnly=false){
  const ex=Array.from(sel.options).some(o=>o.value===val);
  if(!ex && appendOnly) sel.add(new Option(val,val));
}

/* ===== æ™‚åˆ»ã‚»ãƒ¬ã‚¯ãƒˆï¼ˆ30åˆ†åˆ»ã¿ï¼‰ ===== */
function fillTimes(sel, fromMin, toMin){
  sel.innerHTML='<option value=""></option>';
  for(let m=fromMin; m<=toMin; m+=30){
    const hh=String(Math.floor(m/60)).padStart(2,'0');
    const mm=String(m%60).padStart(2,'0');
    const v=`${hh}:${mm}`;
    sel.add(new Option(v,v));
  }
}
fillTimes(lStart, 600, 960); fillTimes(lEnd, 600, 960);         // 10:00â€“16:00
fillTimes(dStart, 1020, 1440); fillTimes(dEnd, 1020, 1440);     // 17:00â€“24:00

/* ===== ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ & ä¸‹æ›¸ã ===== */
let calYear, calMonth;                    // è¡¨ç¤ºä¸­ã®å¹´æœˆ
const drafts = new Map();                 // yyyy-mm-dd -> {l:{start,end,free}, d:{...}, memo}
let submittedMonthCache = [];             // ä»Šæœˆã®é€ä¿¡æ¸ˆã¿ï¼ˆå†æç”»ç”¨ï¼‰

function pad2(n){ return String(n).padStart(2,'0'); }
function setToday(){
  const t=new Date(); t.setHours(0,0,0,0);
  calYear=t.getFullYear(); calMonth=t.getMonth()+1;
  dateInp.value = `${calYear}-${pad2(calMonth)}-${pad2(t.getDate())}`;
}

$('prevBtn').onclick=()=>changeMonth(-1);
$('nextBtn').onclick=()=>changeMonth(1);
$('thisBtn').onclick=()=>{ setToday(); renderCalendar(); loadMonthSubmitted(); };

function changeMonth(d){
  calMonth+=d; if(calMonth===0){calMonth=12;calYear--;} if(calMonth===13){calMonth=1;calYear++;}
  // é¸æŠæ—¥ãŒç¯„å›²å¤–ãªã‚‰æœˆåˆã¸
  const cur = new Date(dateInp.value||`${calYear}-${pad2(calMonth)}-01`);
  if(cur.getFullYear()!==calYear || (cur.getMonth()+1)!==calMonth){
    dateInp.value=`${calYear}-${pad2(calMonth)}-01`;
  }
  renderCalendar(); loadMonthSubmitted();
}

function renderCalendar(){
  $('ymLabel').textContent=`${calYear}å¹´${calMonth}æœˆ`;
  const cal=$('cal'); cal.innerHTML='';
  ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'].forEach(w=>{
    const d=document.createElement('div'); d.textContent=w; d.className='dow'; cal.appendChild(d);
  });
  const first=new Date(calYear,calMonth-1,1);
  const startDow=first.getDay();
  const daysInMonth=new Date(calYear,calMonth,0).getDate();
  const todayStr=(d=>`${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`)(new Date());
  const selStr=dateInp.value;

  for(let i=0;i<startDow;i++){ const e=document.createElement('div'); e.className='cell muted'; cal.appendChild(e); }

  for(let d=1; d<=daysInMonth; d++){
    const ds=`${calYear}-${pad2(calMonth)}-${pad2(d)}`;
    const cell=document.createElement('div'); cell.className='cell';
    if(ds===todayStr) cell.classList.add('today');
    if(ds===selStr) cell.classList.add('selected');
    cell.onclick=()=>{ dateInp.value=ds; loadDraftToForm(); renderCalendar(); };

    const num=document.createElement('div'); num.className='day'; num.textContent=d; cell.appendChild(num);

    const mark=document.createElement('div'); mark.className='mark';

    // ä¸‹æ›¸ãè¡¨ç¤º
    if(drafts.has(ds)){
      const dr=drafts.get(ds);
      if(dr.l){ mark.innerHTML += `<span class="tag l">${dr.l.free?'â—¯':`${dr.l.start||''}ã€œ${dr.l.end||''}`}</span>`; }
      if(dr.d){ mark.innerHTML += `<span class="tag d">${dr.d.free?'â—¯':`${dr.d.start||''}ã€œ${dr.d.end||''}`}</span>`; }
      if(dr.memo){ mark.innerHTML += `<span class="tag draft">ãƒ¡ãƒ¢</span>`; }
    }

    // é€ä¿¡æ¸ˆã¿è¡¨ç¤ºï¼ˆä»Šæœˆåˆ†ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
    const sentForDay=submittedMonthCache.filter(r=>r.date===ds);
    if(sentForDay.length){
      const l = sentForDay.filter(r=>isLunch(r)).map(toLabel).join('<br>');
      const dnr = sentForDay.filter(r=>!isLunch(r)).map(toLabel).join('<br>');
      if(l) mark.innerHTML += `<span class="tag l sent">${l}</span>`;
      if(dnr) mark.innerHTML += `<span class="tag d sent">${dnr}</span>`;
    }

    cell.appendChild(mark);
    cal.appendChild(cell);
  }
}
function isLunch(r){
  // start_time ãŒ 16:00 æœªæº€ã‚’ãƒ©ãƒ³ãƒæ‰±ã„ï¼ˆâ—¯ã®å ´åˆ start_time/end_time ã¯ nullï¼‰
  if(!r.start_time && !r.end_time) return true; // â—¯ã¯æš«å®šçš„ã«ãƒ©ãƒ³ãƒæ‰±ã„ã«è¡¨ç¤º
  return (r.start_time||'00:00') < '16:00';
}
function toLabel(r){
  return (!r.start_time || !r.end_time) ? 'â—¯' : `${r.start_time}ã€œ${r.end_time}`;
}

/* ===== ä¸‹æ›¸ãä¿å­˜/å‰Šé™¤ ===== */
$('saveDraftBtn').onclick = ()=>{
  const nm = nameSel.value || '';
  if(!nm || !nameSel.disabled){ alert('åå‰ã‚’é¸æŠã—ã¦ã€Œâœ”ï¸ ãƒ­ãƒƒã‚¯ã€ã—ã¦ãã ã•ã„'); return; }
  const dt=dateInp.value; if(!dt){ alert('æ—¥ä»˜ã‚’é¸ã‚“ã§ãã ã•ã„'); return; }

  const lunch = lFree.checked || (lStart.value && lEnd.value) ? {
    start: lFree.checked ? null : lStart.value,
    end:   lFree.checked ? null : lEnd.value,
    free:  !!lFree.checked
  }: null;

  const dinner = dFree.checked || (dStart.value && dEnd.value) ? {
    start: dFree.checked ? null : dStart.value,
    end:   dFree.checked ? null : dEnd.value,
    free:  !!dFree.checked
  }: null;

  if(!lunch && !dinner){ alert('ãƒ©ãƒ³ãƒ/ãƒ‡ã‚£ãƒŠãƒ¼ã„ãšã‚Œã‹ã®æ™‚é–“å…¥åŠ›ã¾ãŸã¯â—¯ã‚’é¸ã‚“ã§ãã ã•ã„'); return; }

  drafts.set(dt,{ l:lunch, d:dinner, memo:memo.value||'' });
  msg.textContent=`ä¸‹æ›¸ãã‚’ä¿å­˜ã—ã¾ã—ãŸï¼ˆ${dt}ï¼‰`; msg.className='msg ok';
  renderCalendar();
};
$('removeDraftBtn').onclick = ()=>{
  const dt=dateInp.value; if(drafts.has(dt)){ drafts.delete(dt); renderCalendar(); }
};

function loadDraftToForm(){
  const dt=dateInp.value;
  const dr=drafts.get(dt);
  if(!dr){ // ãƒ•ã‚©ãƒ¼ãƒ åˆæœŸåŒ–ï¼ˆå€¤ã¯æ®‹ã—ã™ããªã„ï¼‰
    lStart.value=""; lEnd.value=""; lFree.checked=false;
    dStart.value=""; dEnd.value=""; dFree.checked=false;
    memo.value=''; return;
  }
  if(dr.l){ lFree.checked=!!dr.l.free; lStart.value=dr.l.start||""; lEnd.value=dr.l.end||""; }
  else { lFree.checked=false; lStart.value=""; lEnd.value=""; }
  if(dr.d){ dFree.checked=!!dr.d.free; dStart.value=dr.d.start||""; dEnd.value=dr.d.end||""; }
  else { dFree.checked=false; dStart.value=""; dEnd.value=""; }
  memo.value=dr.memo||'';
}

/* ===== ä¸€æ‹¬é€ä¿¡ ===== */
$('bulkSendBtn').onclick = async ()=>{
  msg.textContent=''; msg.className='msg';
  const nm=nameSel.value||''; if(!nm || !nameSel.disabled){ alert('åå‰ã‚’ç¢ºå®šã—ã¦ãã ã•ã„'); return; }
  if(drafts.size===0){ alert('ä¸‹æ›¸ããŒã‚ã‚Šã¾ã›ã‚“'); return; }

  // ä¸‹æ›¸ãã‹ã‚‰ãƒ¬ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
  const rows=[];
  for(const [dt,dr] of drafts){
    if(dr.l){
      if(!dr.l.free && dr.l.start && dr.l.end && dr.l.start >= dr.l.end){
        msg.textContent=`ã‚¨ãƒ©ãƒ¼ï¼š${dt} ãƒ©ãƒ³ãƒã®æ™‚é–“ãŒä¸æ­£ã§ã™`; msg.classList.add('err'); return;
      }
      rows.push({
        date:dt, staff_name:nm,
        start_time: dr.l.free? null: dr.l.start,
        end_time:   dr.l.free? null: dr.l.end,
        note: dr.memo||''
      });
    }
    if(dr.d){
      if(!dr.d.free && dr.d.start && dr.d.end && dr.d.start >= dr.d.end){
        msg.textContent=`ã‚¨ãƒ©ãƒ¼ï¼š${dt} ãƒ‡ã‚£ãƒŠãƒ¼ã®æ™‚é–“ãŒä¸æ­£ã§ã™`; msg.classList.add('err'); return;
      }
      rows.push({
        date:dt, staff_name:nm,
        start_time: dr.d.free? null: dr.d.start,
        end_time:   dr.d.free? null: dr.d.end,
        note: dr.memo||''
      });
    }
  }
  if(rows.length===0){ alert('é€ä¿¡å¯¾è±¡ãŒã‚ã‚Šã¾ã›ã‚“'); return; }

  // æ—¢å­˜é‡è¤‡ï¼ˆåŒã˜date+name+æ™‚é–“ï¼‰ã«ã¶ã¤ã‹ã£ã¦ã‚‚æ›´æ–°/ç„¡è¦–ã§ãã‚‹ã‚ˆã† upsert
  const { error } = await supa.from('shifts').upsert(
    rows,
    { onConflict: 'date,staff_name,start_time,end_time' }
  );
  if(error){ msg.textContent='é€ä¿¡ã‚¨ãƒ©ãƒ¼ï¼š'+error.message; msg.classList.add('err'); return; }

  msg.textContent=`${rows.length} ä»¶ é€ä¿¡ã—ã¾ã—ãŸ âœ”ï¸`; msg.classList.add('ok');

  // é€ä¿¡æˆåŠŸ â†’ ä¸‹æ›¸ãã‚¯ãƒªã‚¢ & ç”»é¢æ›´æ–°
  drafts.clear();
  renderCalendar();
  await loadMonthSubmitted();
  loadDraftToForm(); // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ç©ºã«
};

/* ===== ä»Šæœˆã®é€ä¿¡æ¸ˆã¿ãƒ­ãƒ¼ãƒ‰ ===== */
async function loadMonthSubmitted(){
  const start=`${calYear}-${pad2(calMonth)}-01`;
  const end=new Date(start); end.setMonth(end.getMonth()+1);
  const endStr=end.toISOString().slice(0,10);
  const nm=nameSel.value||'';
  if(!nm){ submittedMonthCache=[]; renderCalendar(); return; }
  const { data, error } = await supa
    .from('shifts')
    .select('date,start_time,end_time,staff_name')
    .eq('staff_name', nm).gte('date', start).lt('date', endStr)
    .order('date');
  submittedMonthCache = error ? [] : (data||[]);
  renderCalendar();
}

/* ===== æå‡ºä¸€è¦§ã¸ ===== */
$('toListBtn').onclick=()=>{ location.href=new URL('shiftlink.html', location.href).href; };

/* ===== åˆæœŸåŒ– ===== */
(async function init(){
  // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰åå‰å€™è£œï¼ˆdistinctï¼‰
  const { data } = await supa.from('shifts').select('staff_name').limit(1000);
  const set=new Set((data||[]).map(r=>r.staff_name).filter(Boolean));
  nameSel.innerHTML=''; Array.from(set).sort((a,b)=>a.localeCompare(b,'ja')).forEach(n=>nameSel.add(new Option(n,n)));

  loadLock(); setToday(); renderCalendar(); await loadMonthSubmitted();
  // åˆæœŸãƒ•ã‚©ãƒ¼ãƒ 
  loadDraftToForm();
})();
</script>
</body>
</html>
